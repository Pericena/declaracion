<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lector QR</title>
  <style>
    body {
      background-color: #f0f0f0; /* Cambia el color de fondo según tus preferencias */
      font-family: 'Arial', sans-serif;
    }

    #video-container {
      text-align: center;
      margin: 20px auto;
    }

    #video {
      width: 100%;
      max-width: 600px;
    }

    #result {
      margin-top: 20px;
      display: none;
    }

    h1 {
      text-align: center;
      color: #333; /* Cambia el color del título según tus preferencias */
    }

    #controlButtons {
      text-align: center;
      margin-top: 10px;
    }

    button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Lector de QR</h1>
  <div id="video-container">
    <video id="video" playsinline autoplay></video>
  </div>
  <div id="result"></div>

  <div id="controlButtons">
    <button id="startButton" onclick="startCamera()">Iniciar Cámara</button>
    <button id="stopButton" onclick="stopCamera()">Detener Cámara</button>
  </div>

  <script>
    // Acceder al elemento de video y al resultado
    const video = document.getElementById('video');
    const resultDiv = document.getElementById('result');

    // Crear un canvas para capturar frames de video
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    // Variable para evitar múltiples alertas por el mismo código QR
    let codeDetected = false;

    // Función para iniciar la cámara
    function startCamera() {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then((stream) => {
          // Enlazar la corriente al elemento de video
          video.srcObject = stream;
        })
        .catch((err) => console.error('Error al acceder a la cámara:', err));
    }

    // Función para detener la cámara
    function stopCamera() {
      const stream = video.srcObject;
      const tracks = stream.getTracks();

      tracks.forEach((track) => track.stop());
      video.srcObject = null;
    }

    // Configurar intervalo para capturar frames y buscar códigos QR
    setInterval(() => {
      if (!video.srcObject) {
        return; // No hacer nada si la cámara no está activada
      }

      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Obtener el código QR de la imagen del canvas
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(imageData.data, imageData.width, imageData.height);

      if (code && !codeDetected) {
        // Mostrar el resultado
        resultDiv.textContent = 'Resultado: ' + code.data;
        resultDiv.style.display = 'block';

        // Alertar una vez cuando se detecta un código QR
        alert('Código QR detectado: ' + code.data);
        codeDetected = true;
      }
    }, 1000); // Puedes ajustar el intervalo según tus necesidades
  </script>

  <!-- Agregar la biblioteca jsQR para decodificar códigos QR -->
  <!-- Puedes descargar jsQR desde: https://github.com/cozmo/jsQR -->
  <!-- O usar el siguiente enlace de CDN (asegúrate de tener una conexión a Internet): -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/jsqr@1.5.0/dist/jsQR.js"></script> -->
  <script src="jsQR.js"></script>
</body>
</html>
